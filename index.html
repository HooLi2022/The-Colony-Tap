<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç –ó–∞—Å–µ–ª–µ–Ω–∏–µ –ó–µ–º–ª–∏</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0B0B2B, #1B1B4B);
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            padding: 16px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            text-align: center;
        }

        .earth {
            position: relative;
            width: min(280px, 60vw);
            height: min(280px, 60vw);
            margin: 16px auto;
            border-radius: 50%;
            background: #2B3B4B;
            box-shadow: 0 0 40px rgba(100,150,255,0.3);
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .earth:active {
            transform: scale(0.98);
        }

        /* –¶–≤–µ—Ç–Ω–∞—è –∑–∞–ª–∏–≤–∫–∞ (—Ç–µ–ø–µ—Ä—å —ç—Ç–æ –º–∞—Å–∫–∞ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–∫–∏) */
        .earth-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: #4CAF50;
            transition: height 0.3s ease-out;
            z-index: 1;
        }

        /* –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ó–µ–º–ª–∏ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–∞, –ø–æ—è–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–∞—Å–∫—É) */
        .earth-image {
            position: absolute;
            inset: 0;
            background: url('–°–°–´–õ–ö–ê_–ù–ê_–¢–í–û–Æ_–ö–ê–†–¢–ò–ù–ö–£') center/cover;
            z-index: 2;
            clip-path: inset(100% 0 0 0);
            transition: clip-path 0.3s ease-out;
        }

        .progress-section {
            margin: 16px 0;
        }

        .progress-bar {
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s;
        }

        .counter {
            font-size: clamp(2.5rem, 10vw, 4rem);
            font-weight: bold;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 16px;
            margin: 16px 0;
            border: 2px solid rgba(255,215,0,0.3);
            text-shadow: 0 0 20px rgba(255,215,0,0.5);
        }

        .name-section {
            margin: 20px 0;
            min-height: 80px;
        }

        .name-input-group {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .name-input {
            padding: 12px 20px;
            border-radius: 30px;
            border: none;
            width: 250px;
            font-size: 1.1em;
            background: rgba(255,255,255,0.95);
        }

        .name-button {
            padding: 12px 30px;
            border-radius: 30px;
            border: none;
            background: #ffd700;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: 0.2s;
        }

        .name-button:hover {
            background: #ffed4a;
            transform: scale(1.05);
        }

        .greeting {
            font-size: 1.4em;
            padding: 12px 24px;
            background: rgba(255,255,255,0.15);
            border-radius: 40px;
            display: inline-block;
            border: 2px solid #ffd700;
        }

        .greeting-name {
            color: #ffd700;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }

        .click-button {
            background: #ffd700;
            color: #333;
            border: none;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            padding: 20px 40px;
            border-radius: 60px;
            cursor: pointer;
            font-weight: bold;
            margin: 16px 0;
            transition: all 0.2s;
            box-shadow: 0 0 30px rgba(255,215,0,0.5);
            width: 100%;
            max-width: 400px;
        }

        .click-button:not(:disabled):hover {
            transform: scale(1.05);
            background: #ffed4a;
            box-shadow: 0 0 50px rgba(255,215,0,0.8);
        }

        .click-button:not(:disabled):active {
            transform: scale(0.95);
        }

        .click-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            border-radius: 16px;
            padding: 12px;
            font-size: 0.9rem;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            margin-top: 4px;
        }

        .top-players {
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 16px;
            margin-top: 20px;
        }

        .top-title {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 16px;
        }

        .top-list {
            list-style: none;
        }

        .top-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            margin: 6px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            transition: 0.2s;
        }

        .top-item.current {
            border: 2px solid #ffd700;
            background: rgba(255,215,0,0.15);
        }

        .top-rank {
            width: 32px;
            height: 32px;
            background: #ffd700;
            color: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .top-rank-1 { background: #FFD700; box-shadow: 0 0 15px #FFD700; }
        .top-rank-2 { background: #C0C0C0; box-shadow: 0 0 15px #C0C0C0; }
        .top-rank-3 { background: #CD7F32; box-shadow: 0 0 15px #CD7F32; }

        .top-name {
            flex: 1;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .top-score {
            font-weight: bold;
            color: #ffd700;
            margin-left: 8px;
        }

        .last-clicker {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 10px;
            margin-top: 16px;
        }

        #lastClickerName {
            color: #ffd700;
            font-weight: bold;
        }

        .cheater-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff4444;
            color: white;
            padding: 16px 24px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(255,0,0,0.5);
            z-index: 1000;
            animation: slideDown 0.3s;
            display: none;
        }

        .admin-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255,215,0,0.9);
            color: #333;
            padding: 12px 20px;
            border-radius: 40px;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-btn:hover {
            transform: scale(1.05);
            background: #ffd700;
        }

        .admin-btn .notification {
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            margin-left: 8px;
        }

        .admin-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a3a, #2a2a4a);
            border: 3px solid #ffd700;
            border-radius: 30px;
            padding: 30px;
            z-index: 2000;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(255,215,0,0.3);
            display: none;
        }

        .admin-panel.show {
            display: block;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255,215,0,0.3);
            padding-bottom: 15px;
        }

        .panel-header h2 {
            color: #ffd700;
            font-size: 1.8rem;
        }

        .close-panel {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }

        .close-panel:hover {
            background: rgba(255,0,0,0.3);
        }

        .admin-section {
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .admin-section h3 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .admin-stat {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }

        .admin-stat-label {
            font-size: 0.8rem;
            color: #aaa;
        }

        .admin-stat-value {
            font-size: 1.3rem;
            color: #ffd700;
            font-weight: bold;
        }

        .admin-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .admin-action-btn {
            background: rgba(255,215,0,0.2);
            border: 1px solid #ffd700;
            color: white;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.2s;
            font-weight: bold;
        }

        .admin-action-btn:hover {
            background: rgba(255,215,0,0.4);
            transform: scale(1.02);
        }

        .admin-action-btn.danger {
            background: rgba(255,68,68,0.2);
            border-color: #ff4444;
        }

        .admin-action-btn.danger:hover {
            background: rgba(255,68,68,0.4);
        }

        .admin-action-btn.success {
            background: rgba(76,175,80,0.2);
            border-color: #4CAF50;
        }

        .admin-action-btn.success:hover {
            background: rgba(76,175,80,0.4);
        }

        .player-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .player-item.banned {
            border-left: 3px solid #ff4444;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: bold;
            color: #ffd700;
        }

        .player-score {
            font-size: 0.9rem;
            color: #aaa;
        }

        .player-actions {
            display: flex;
            gap: 5px;
        }

        .player-action {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1500;
            display: none;
        }

        .backdrop.show {
            display: block;
        }

        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        .unban-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 16px 24px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(76,175,80,0.5);
            z-index: 1000;
            animation: slideDown 0.3s;
            display: none;
        }

        .reset-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #ffd700;
            color: #333;
            padding: 16px 24px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(255,215,0,0.5);
            z-index: 1000;
            animation: slideDown 0.3s;
            display: none;
        }
    </style>
</head>
<body>
    <div class="cheater-alert" id="cheaterAlert">üö´ –û–±–Ω–∞—Ä—É–∂–µ–Ω —á–∏—Ç–µ—Ä! –î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</div>
    <div class="unban-message" id="unbanMessage">‚úÖ –í—ã –±—ã–ª–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º!</div>
    <div class="reset-message" id="resetMessage">üîÑ –ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!</div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞ —Å–ª–µ–≤–∞ -->
    <div class="admin-btn" id="adminBtn">
        <span>üëë –ê–¥–º–∏–Ω</span>
        <span class="notification" id="adminNotification">0</span>
    </div>
    
    <div class="backdrop" id="backdrop"></div>
    
    <div class="admin-panel" id="adminPanel">
        <div class="panel-header">
            <h2>üëë –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
            <button class="close-panel" id="closePanel">√ó</button>
        </div>
        
        <div class="admin-stats">
            <div class="admin-stat">
                <div class="admin-stat-label">–ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å—á–µ—Ç</div>
                <div class="admin-stat-value" id="adminGlobalScore">0</div>
            </div>
            <div class="admin-stat">
                <div class="admin-stat-label">–ò–≥—Ä–æ–∫–æ–≤</div>
                <div class="admin-stat-value" id="adminTotalPlayers">0</div>
            </div>
            <div class="admin-stat">
                <div class="admin-stat-label">–û–Ω–ª–∞–π–Ω</div>
                <div class="admin-stat-value" id="adminOnline">0</div>
            </div>
        </div>
        
        <div class="admin-section">
            <h3>‚ö° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π</h3>
            <div class="admin-actions">
                <button class="admin-action-btn success" onclick="admin.resetGame()">üîÑ –°–±—Ä–æ—Å –∏–≥—Ä—ã (–¥–ª—è –≤—Å–µ—Ö)</button>
                <button class="admin-action-btn success" onclick="admin.addGlobalClicks(100)">‚ûï +100 –∫–ª–∏–∫–æ–≤</button>
                <button class="admin-action-btn" onclick="admin.setTarget('8b')">üéØ –¶–µ–ª—å 8 –º–ª—Ä–¥</button>
                <button class="admin-action-btn" onclick="admin.setTarget('1m')">üéØ –¶–µ–ª—å 1 –º–ª–Ω</button>
            </div>
        </div>
        
        <div class="admin-section">
            <h3>üë• –ò–≥—Ä–æ–∫–∏</h3>
            <div class="player-list" id="playerList">
                <div style="text-align: center; color: #aaa;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
        
        <div class="admin-section">
            <h3>üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h3>
            <div class="admin-actions">
                <button class="admin-action-btn" onclick="admin.clearBanned()">‚úÖ –†–∞–∑–±–∞–Ω–∏—Ç—å –≤—Å–µ—Ö</button>
                <button class="admin-action-btn danger" onclick="admin.banAll()">üö´ –ó–∞–±–∞–Ω–∏—Ç—å –≤—Å–µ—Ö</button>
                <button class="admin-action-btn danger" onclick="admin.clearDatabase()">‚ö†Ô∏è –û—á–∏—Å—Ç–∏—Ç—å –ë–î</button>
            </div>
        </div>
    </div>

    <div class="container">
        <h1>üåç –ó–∞—Å–µ–ª–µ–Ω–∏–µ –ó–µ–º–ª–∏</h1>
        <p>–¶–µ–ª—å: <span id="targetDisplay">8 –º–ª—Ä–¥</span></p>
        
        <div class="earth" id="earth">
            <!-- –¶–≤–µ—Ç–Ω–∞—è –∑–∞–ª–∏–≤–∫–∞ (—Ñ–æ–Ω) -->
            <div class="earth-fill" id="earthFill"></div>
            <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ó–µ–º–ª–∏ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö) -->
            <div class="earth-image" id="earthImage"></div>
        </div>
        
        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="earth-target">
                <span id="currentPop">0</span> / <span id="targetPopulation">8 000 000 000</span>
            </div>
        </div>
        
        <div class="counter" id="counter">0</div>
        
        <div class="name-section">
            <div id="nameInputGroup" class="name-input-group">
                <input type="text" id="username" class="name-input" placeholder="–í–∞—à–µ –∏–º—è" maxlength="20" autocomplete="off">
                <button id="saveNameBtn" class="name-button">–ù–∞—á–∞—Ç—å</button>
            </div>
            <div id="greeting" class="greeting hidden">
                <span>–ò–≥—Ä–æ–∫: <span id="displayName" class="greeting-name"></span></span>
            </div>
        </div>
        
        <button id="clickBtn" class="click-button" disabled>üëÜ –ó–ê–°–ï–õ–ò–¢–¨</button>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div>–û–Ω–ª–∞–π–Ω</div>
                <div class="stat-value" id="onlineCount">0</div>
            </div>
            <div class="stat-card">
                <div>–¢–≤–æ–π –≤–∫–ª–∞–¥</div>
                <div class="stat-value" id="userScore">0</div>
            </div>
            <div class="stat-card">
                <div>–û—Å—Ç–∞–ª–æ—Å—å</div>
                <div class="stat-value" id="remaining">8 –º–ª—Ä–¥</div>
            </div>
        </div>
        
        <div class="top-players">
            <div class="top-title">üèÜ –¢–æ–ø</div>
            <div id="topList" class="top-list">
                <div class="top-item">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
        
        <div class="last-clicker">
            –ü–æ—Å–ª–µ–¥–Ω–∏–π: <span id="lastClickerName">–Ω–∏–∫—Ç–æ</span>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        (function() {
            'use strict';
            
            // ===== –ó–ê–ú–ê–°–ö–ò–†–û–í–ê–ù–ù–´–ï –î–ê–ù–ù–´–ï =====
            const _0x4d5e = {
                api: 'QUl6YVN5QV9nTmtMTXN4VG5lVHd5ZzViRHhLQk45b3NSSVVyUGFF',
                auth: 'dGhlLWNvbG9ueS10YXAuZmlyZWJhc2VhcHAuY29t',
                db: 'aHR0cHM6Ly90aGUtY29sb255LXRhcC1kZWZhdWx0LXJ0ZGIuZmlyZWJhc2Vpby5jb20=',
                project: 'dGhlLWNvbG9ueS10YXA=',
                storage: 'dGhlLWNvbG9ueS10YXAuZmlyZWJhc3VzdG9yYWdlLmFwcA==',
                sender: 'NDMzNDM4NzMzNjE2',
                app: 'MTo0MzM0Mzg3MzM2MTY6d2ViOjc2MDk1YTM2MTYxYjMyNTkwZDQ0ZjU='
            };

            const _decode = (str) => {
                try { return atob(str); } catch { return ''; }
            };

            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
            const C = {
                TARGET: 8000000000,
                TARGETS: {
                    '8b': 8000000000,
                    '1m': 1000000
                },
                STORAGE: { N: 'wc_n', S: 'wc_s', I: 'wc_i', NS: 'wc_ns', CC: 'wc_cc', AM: 'wc_am' },
                LIMITS: { M1: 20, M2: 300, M3: 1000, INT: 5000, BAN: 3 },
                KEY: 'Lm9rMjAyNQ==',
                RESET_FLAG: 'reset_trigger'
            };

            // Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            firebase.initializeApp({
                apiKey: _decode(_0x4d5e.api),
                authDomain: _decode(_0x4d5e.auth),
                databaseURL: _decode(_0x4d5e.db),
                projectId: _decode(_0x4d5e.project),
                storageBucket: _decode(_0x4d5e.storage),
                messagingSenderId: _decode(_0x4d5e.sender),
                appId: _decode(_0x4d5e.app)
            });

            const db = firebase.database();
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
            const el = {
                e: document.getElementById('earth'),
                ef: document.getElementById('earthFill'),
                ei: document.getElementById('earthImage'),
                pf: document.getElementById('progressFill'),
                c: document.getElementById('counter'),
                cp: document.getElementById('currentPop'),
                r: document.getElementById('remaining'),
                oc: document.getElementById('onlineCount'),
                us: document.getElementById('userScore'),
                lc: document.getElementById('lastClickerName'),
                tl: document.getElementById('topList'),
                nig: document.getElementById('nameInputGroup'),
                g: document.getElementById('greeting'),
                dn: document.getElementById('displayName'),
                un: document.getElementById('username'),
                snb: document.getElementById('saveNameBtn'),
                cb: document.getElementById('clickBtn'),
                ca: document.getElementById('cheaterAlert'),
                um: document.getElementById('unbanMessage'),
                rm: document.getElementById('resetMessage'),
                adminBtn: document.getElementById('adminBtn'),
                adminPanel: document.getElementById('adminPanel'),
                bd: document.getElementById('backdrop'),
                close: document.getElementById('closePanel'),
                playerList: document.getElementById('playerList'),
                adminNotification: document.getElementById('adminNotification'),
                adminGlobalScore: document.getElementById('adminGlobalScore'),
                adminTotalPlayers: document.getElementById('adminTotalPlayers'),
                adminOnline: document.getElementById('adminOnline'),
                targetDisplay: document.getElementById('targetDisplay'),
                targetPopulation: document.getElementById('targetPopulation')
            };

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ
            const s = {
                u: '',
                globalScore: 0,
                myScore: 0,
                pid: null,
                ns: false,
                or: null,
                pr: null,
                ct: [],
                lsc: 0,
                lch: Date.now(),
                cc: 0,
                b: false,
                admin: false,
                players: {},
                online: 0,
                clickLock: false,
                target: C.TARGET,
                pendingClick: false
            };

            // –•—Ä–∞–Ω–∏–ª–∏—â–µ
            const stor = {
                g: (k) => { try { return localStorage.getItem(C.STORAGE[k]); } catch { return null; } },
                s: (k, v) => { try { localStorage.setItem(C.STORAGE[k], v); } catch {} },
                r: (k) => { try { localStorage.removeItem(C.STORAGE[k]); } catch {} }
            };

            // ===== UI =====
            function updateUI() {
                if (s.b && !s.admin) {
                    el.cb.disabled = true;
                    el.e.style.pointerEvents = 'none';
                } else if (s.ns) {
                    el.cb.disabled = false;
                    el.e.style.pointerEvents = 'auto';
                }
                
                if (s.ns && s.u) {
                    el.nig.classList.add('hidden');
                    el.g.classList.remove('hidden');
                    el.dn.textContent = s.u;
                } else {
                    el.nig.classList.remove('hidden');
                    el.g.classList.add('hidden');
                }

                const p = Math.min((s.globalScore / s.target) * 100, 100);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç–Ω—É—é –∑–∞–ª–∏–≤–∫—É (—Ñ–æ–Ω)
                el.ef.style.height = p + '%';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É - –æ–Ω–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö
                // clip-path: inset(100% - p% 0 0 0) - –æ–±—Ä–µ–∑–∞–µ—Ç —Å–≤–µ—Ä—Ö—É
                const clipValue = (100 - p) + '%';
                el.ei.style.clipPath = `inset(${clipValue} 0 0 0)`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                el.pf.style.width = p + '%';

                el.c.textContent = s.globalScore.toLocaleString();
                el.cp.textContent = s.globalScore.toLocaleString();
                el.r.textContent = Math.max(s.target - s.globalScore, 0).toLocaleString();
                el.us.textContent = s.myScore.toLocaleString();
                
                if (s.admin) {
                    el.adminGlobalScore.textContent = s.globalScore.toLocaleString();
                    el.adminTotalPlayers.textContent = Object.keys(s.players).length;
                    el.adminOnline.textContent = s.online;
                }
            }

            // ===== –§–£–ù–ö–¶–ò–Ø –ì–õ–û–ë–ê–õ–¨–ù–û–ì–û –°–ë–†–û–°–ê =====
            function performGlobalReset() {
                el.rm.style.display = 'block';
                setTimeout(() => { el.rm.style.display = 'none'; }, 3000);
                
                s.globalScore = 0;
                s.myScore = 0;
                s.ns = false;
                s.u = '';
                s.pid = null;
                s.pr = null;
                s.b = false;
                
                localStorage.clear();
                
                el.un.value = '';
                el.nig.classList.remove('hidden');
                el.g.classList.add('hidden');
                
                if (s.or) s.or.remove();
                s.or = db.ref('onlineUsers').push();
                s.or.set({ n: '–ê–Ω–æ–Ω–∏–º', on: true, ls: Date.now(), pid: null });
                
                updateUI();
            }

            // ===== –°–õ–£–®–ê–¢–ï–õ–¨ –ì–õ–û–ë–ê–õ–¨–ù–û–ì–û –°–ë–†–û–°–ê =====
            db.ref('admin/reset').on('value', (snap) => {
                if (snap.val() === true) {
                    performGlobalReset();
                    db.ref('admin/reset').set(false);
                }
            });

            // ===== –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ =====
            const admin = {
                open() {
                    if (!s.admin) {
                        const secret = prompt('üîê –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞:');
                        if (secret === atob(C.KEY)) {
                            this.enable();
                        }
                        return;
                    }
                    el.adminPanel.classList.add('show');
                    el.bd.classList.add('show');
                    this.updatePlayerList();
                },
                close() {
                    el.adminPanel.classList.remove('show');
                    el.bd.classList.remove('show');
                },
                enable() {
                    s.admin = true;
                    stor.s('AM', 'true');
                    this.open();
                },
                disable() {
                    s.admin = false;
                    stor.r('AM');
                    this.close();
                },
                updatePlayerList() {
                    const players = Object.entries(s.players)
                        .map(([id, data]) => ({ id, ...data }))
                        .sort((a, b) => (b.sc || 0) - (a.sc || 0));

                    if (players.length === 0) {
                        el.playerList.innerHTML = '<div style="text-align: center; color: #aaa;">–ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤</div>';
                        return;
                    }

                    el.playerList.innerHTML = players.map(p => `
                        <div class="player-item ${p.b ? 'banned' : ''}">
                            <div class="player-info">
                                <div class="player-name">${p.n || '–ê–Ω–æ–Ω–∏–º'}</div>
                                <div class="player-score">üëÜ ${(p.sc || 0).toLocaleString()} | ‚ö†Ô∏è ${p.cc || 0}</div>
                            </div>
                            <div class="player-actions">
                                ${p.b ? 
                                    `<button class="player-action" style="background:#4CAF50" onclick="admin.unbanPlayer('${p.id}')">‚úÖ</button>` :
                                    `<button class="player-action" style="background:#ff4444" onclick="admin.banPlayer('${p.id}')">üö´</button>`
                                }
                                <button class="player-action" style="background:#ffd700" onclick="admin.addPlayerClicks('${p.id}', 10)">+10</button>
                                <button class="player-action" style="background:#666" onclick="admin.deletePlayer('${p.id}')">üóëÔ∏è</button>
                            </div>
                        </div>
                    `).join('');
                },
                resetGame() {
                    if (!s.admin || !confirm('‚ö†Ô∏è –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É –¥–ª—è –í–°–ï–• –∏–≥—Ä–æ–∫–æ–≤? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) return;
                    
                    db.ref('admin/reset').set(true);
                    db.ref('globalCounter').set(0);
                    db.ref('players').remove();
                    db.ref('onlineUsers').remove();
                    
                    this.close();
                },
                addGlobalClicks(amount) {
                    if (!s.admin) return;
                    db.ref('globalCounter').transaction(v => (v || 0) + amount);
                },
                setTarget(type) {
                    if (!s.admin) return;
                    s.target = C.TARGETS[type] || C.TARGET;
                    el.targetDisplay.textContent = type === '8b' ? '8 –º–ª—Ä–¥' : '1 –º–ª–Ω';
                    el.targetPopulation.textContent = s.target.toLocaleString();
                    updateUI();
                },
                banPlayer(id) {
                    if (!s.admin) return;
                    db.ref('players/' + id).update({ b: true, br: '–ê–¥–º–∏–Ω', bt: Date.now() });
                },
                unbanPlayer(id) {
                    if (!s.admin) return;
                    db.ref('players/' + id).update({ b: false, br: null, bt: null, cc: 0 });
                },
                deletePlayer(id) {
                    if (!s.admin || !confirm('–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞?')) return;
                    db.ref('players/' + id).remove();
                },
                addPlayerClicks(id, amount) {
                    if (!s.admin) return;
                    
                    db.ref('players/' + id).transaction(p => {
                        if (!p) p = { sc: 0 };
                        p.sc = (p.sc || 0) + amount;
                        return p;
                    });
                    
                    db.ref('globalCounter').transaction(v => (v || 0) + amount);
                },
                clearBanned() {
                    if (!s.admin) return;
                    
                    Object.keys(s.players).forEach(id => {
                        if (s.players[id].b) {
                            db.ref('players/' + id).update({ b: false, cc: 0 });
                        }
                    });
                },
                banAll() {
                    if (!s.admin || !confirm('–ó–∞–±–∞–Ω–∏—Ç—å –≤—Å–µ—Ö?')) return;
                    
                    Object.keys(s.players).forEach(id => {
                        db.ref('players/' + id).update({ b: true, br: '–ú–∞—Å—Å–æ–≤—ã–π –±–∞–Ω' });
                    });
                },
                clearDatabase() {
                    if (!s.admin || !confirm('‚ö†Ô∏è –ü–û–õ–ù–ê–Ø –û–ß–ò–°–¢–ö–ê –ë–ê–ó–´?!')) return;
                    
                    db.ref('/').remove();
                    localStorage.clear();
                    setTimeout(() => location.reload(), 1000);
                }
            };

            window.admin = admin;

            // ===== –°–õ–£–®–ê–¢–ï–õ–¨ –°–¢–ê–¢–£–°–ê =====
            function setupListener() {
                if (!s.pid) return;
                
                db.ref('players/' + s.pid).on('value', (snap) => {
                    const d = snap.val();
                    if (!d) return;
                    
                    if (d.b !== undefined && d.b !== s.b) {
                        s.b = d.b;
                        if (!s.b) {
                            el.um.style.display = 'block';
                            setTimeout(() => { el.um.style.display = 'none'; }, 3000);
                        }
                    }
                    
                    if (d.sc !== undefined && d.sc !== s.myScore && !s.clickLock) {
                        s.myScore = d.sc;
                        stor.s('S', d.sc);
                    }
                    
                    updateUI();
                });
            }

            // ===== –ê–ù–¢–ò–ß–ò–¢ =====
            const ac = {
                check() {
                    if (s.admin) return true;
                    if (s.b) return false;
                    
                    const now = Date.now();
                    const sec = s.ct.filter(t => t > now - 1000).length;
                    const min = s.ct.filter(t => t > now - 60000).length;
                    
                    if (sec > C.LIMITS.M1) { this.record('–ß–∞—Å—Ç–æ'); return false; }
                    if (min > C.LIMITS.M2) { this.record('–ú–Ω–æ–≥–æ'); return false; }
                    
                    if (now - s.lch > C.LIMITS.INT) {
                        if (s.myScore - s.lsc > C.LIMITS.M3) { this.record('–†–æ—Å—Ç'); return false; }
                        s.lsc = s.myScore;
                        s.lch = now;
                    }
                    return true;
                },
                record(r) {
                    if (s.admin) return;
                    s.cc++;
                    stor.s('CC', s.cc);
                    
                    el.ca.style.display = 'block';
                    setTimeout(() => { el.ca.style.display = 'none'; }, 3000);
                    
                    if (s.cc >= C.LIMITS.BAN) {
                        s.b = true;
                        el.cb.disabled = true;
                        el.e.style.pointerEvents = 'none';
                        if (s.pr) s.pr.update({ b: true, cc: s.cc, br: r, bt: Date.now() });
                        if (s.or) s.or.remove();
                    }
                },
                clean() {
                    const now = Date.now();
                    s.ct = s.ct.filter(t => t > now - 120000);
                }
            };

            // ===== FIREBASE –°–õ–£–®–ê–¢–ï–õ–ò =====
            db.ref('globalCounter').on('value', snap => {
                if (!s.b || s.admin) {
                    const newVal = snap.val() || 0;
                    
                    if (Math.abs(newVal - s.globalScore) < 100) {
                        s.globalScore = newVal;
                    } else if (!s.clickLock) {
                        s.globalScore = newVal;
                    }
                    
                    updateUI();
                }
            });

            db.ref('lastClick').on('value', snap => {
                if (!s.b || s.admin) {
                    const d = snap.val();
                    el.lc.textContent = d?.n || '–Ω–∏–∫—Ç–æ';
                }
            });

            db.ref('onlineUsers').on('value', snap => {
                if (!s.b || s.admin) {
                    s.online = snap.val() ? Object.keys(snap.val()).length : 0;
                    el.oc.textContent = s.online;
                    if (s.admin) el.adminOnline.textContent = s.online;
                    
                    if (s.admin) {
                        const bannedCount = Object.values(s.players).filter(p => p.b).length;
                        el.adminNotification.textContent = bannedCount;
                    }
                }
            });

            db.ref('players').on('value', snap => {
                const players = snap.val() || {};
                s.players = players;
                
                if (!s.b || s.admin) {
                    const list = Object.entries(players)
                        .map(([id, d]) => ({ id, ...d }))
                        .filter(p => p.sc > 0 && !p.b)
                        .sort((a, b) => b.sc - a.sc)
                        .slice(0, 10);

                    if (list.length) {
                        el.tl.innerHTML = list.map((p, i) => {
                            const rc = i === 0 ? 'top-rank-1' : i === 1 ? 'top-rank-2' : i === 2 ? 'top-rank-3' : '';
                            const cur = p.id === s.pid;
                            return `
                                <div class="top-item ${cur ? 'current' : ''}">
                                    <div class="top-rank ${rc}">${i + 1}</div>
                                    <span class="top-name">${p.n || '–ê–Ω–æ–Ω–∏–º'}</span>
                                    <span class="top-score">${p.sc.toLocaleString()}</span>
                                </div>
                            `;
                        }).join('');
                    } else {
                        el.tl.innerHTML = '<div class="top-item">–ù–µ—Ç –∫–ª–∏–∫–æ–≤</div>';
                    }
                }
                
                if (s.admin && el.adminPanel.classList.contains('show')) {
                    admin.updatePlayerList();
                }
                
                if (s.admin) {
                    const bannedCount = Object.values(players).filter(p => p.b).length;
                    el.adminNotification.textContent = bannedCount;
                }
            });

            // ===== –ö–õ–ò–ö =====
            async function clickHandler() {
                if (s.clickLock) return;
                if (!ac.check()) return;
                
                s.clickLock = true;
                s.pendingClick = true;
                s.ct.push(Date.now());
                ac.clean();

                const oldGlobal = s.globalScore;
                const oldMy = s.myScore;

                try {
                    const r = await db.ref('globalCounter').transaction(v => (v || 0) + 1);
                    if (r.committed) {
                        if (s.pr && (!s.b || s.admin)) {
                            const pr = await s.pr.transaction(p => {
                                if (!p) p = { sc: 0 };
                                p.sc = (p.sc || 0) + 1;
                                p.n = s.u;
                                p.ls = Date.now();
                                return p;
                            });
                            if (pr.committed) {
                                s.myScore = pr.snapshot.val().sc;
                                stor.s('S', s.myScore);
                            }
                        }
                        
                        s.globalScore = r.snapshot.val();
                        
                        await db.ref('lastClick').set({ n: s.u, t: Date.now(), pid: s.pid });
                        
                        updateUI();

                        if (s.globalScore >= s.target) {
                            setTimeout(() => alert('üéâ –ü–û–ë–ï–î–ê! –ó–ï–ú–õ–Ø –ó–ê–°–ï–õ–ï–ù–ê! üéâ'), 100);
                        }
                    } else {
                        s.globalScore = oldGlobal;
                        s.myScore = oldMy;
                    }
                } catch (e) {
                    s.globalScore = oldGlobal;
                    s.myScore = oldMy;
                }
                
                s.pendingClick = false;
                setTimeout(() => {
                    s.clickLock = false;
                }, 300);
            }

            // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
            function init() {
                s.admin = stor.g('AM') === 'true';
                
                s.ns = stor.g('NS') === 'true';
                s.u = stor.g('N') || '';
                s.pid = stor.g('I') || null;
                s.myScore = parseInt(stor.g('S') || '0');
                s.cc = parseInt(stor.g('CC') || '0');
                
                if (s.u) el.un.value = s.u;

                db.ref('globalCounter').once('value').then(snap => {
                    s.globalScore = snap.val() || 0;
                    
                    if (s.ns && s.pid) {
                        db.ref('players/' + s.pid).once('value').then(snap => {
                            if (snap.exists()) {
                                const d = snap.val();
                                s.pr = db.ref('players/' + s.pid);
                                s.b = d.b === true;
                                
                                if (d.sc !== s.myScore && !s.clickLock) {
                                    if (d.sc < s.myScore) {
                                        s.pr.update({ sc: s.myScore });
                                    } else {
                                        s.myScore = d.sc;
                                        stor.s('S', d.sc);
                                    }
                                }
                                
                                setupListener();
                            } else if (!s.b || s.admin) {
                                createPlayer();
                            }
                            
                            updateUI();
                        });
                    } else if (s.ns && (!s.b || s.admin)) {
                        createPlayer();
                    } else {
                        updateUI();
                    }
                });
                
                // –û–Ω–ª–∞–π–Ω
                if (!s.b || s.admin) {
                    s.or = db.ref('onlineUsers').push();
                    s.or.set({ n: s.u || '–ê–Ω–æ–Ω–∏–º', on: true, ls: Date.now(), pid: s.pid });
                    
                    window.addEventListener('beforeunload', () => {
                        if (s.or) s.or.remove();
                        if (s.pr && (!s.b || s.admin)) {
                            s.pr.update({ ls: Date.now(), on: false, cc: s.cc });
                            stor.s('S', s.myScore);
                        }
                    });
                }

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                el.snb.addEventListener('click', () => {
                    const name = el.un.value.trim();
                    if (!name) return;
                    s.u = name;
                    s.ns = true;
                    stor.s('N', name);
                    stor.s('NS', 'true');
                    createPlayer();
                    updateUI();
                });

                el.un.addEventListener('keypress', e => e.key === 'Enter' && el.snb.click());
                el.cb.addEventListener('click', clickHandler);
                el.e.addEventListener('click', clickHandler);
                
                el.adminBtn.addEventListener('click', () => admin.open());
                el.close.addEventListener('click', () => admin.close());
                el.bd.addEventListener('click', () => admin.close());

                setInterval(() => {
                    if (s.b && !s.admin) return;
                    ac.check();
                    ac.clean();
                    if (s.or) s.or.update({ ls: Date.now(), n: s.u || '–ê–Ω–æ–Ω–∏–º', cc: s.cc });
                    if (s.pr && s.ns && (!s.b || s.admin)) {
                        s.pr.update({ ls: Date.now(), n: s.u, cc: s.cc });
                        stor.s('S', s.myScore);
                    }
                }, 15000);

                el.targetPopulation.textContent = s.target.toLocaleString();
            }

            function createPlayer() {
                if (s.b && !s.admin) return;
                
                const nr = db.ref('players').push();
                nr.set({
                    n: s.u,
                    sc: s.myScore,
                    j: Date.now(),
                    ls: Date.now(),
                    cc: s.cc,
                    b: false
                }).then(() => {
                    s.pr = nr;
                    s.pid = nr.key;
                    stor.s('I', s.pid);
                    s.b = false;
                    setupListener();
                });
            }

            init();
        })();
    </script>
</body>
</html>