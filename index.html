<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç –ó–∞—Å–µ–ª–µ–Ω–∏–µ –ó–µ–º–ª–∏</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0B0B2B, #1B1B4B);
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            padding: 16px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            text-align: center;
        }

        .earth {
            position: relative;
            width: min(280px, 60vw);
            height: min(280px, 60vw);
            margin: 16px auto;
            border-radius: 50%;
            background: #2B3B4B;
            box-shadow: 0 0 40px rgba(100,150,255,0.3);
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .earth:active {
            transform: scale(0.98);
        }

        .earth-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(180deg, #4CAF50, #2E7D32);
            transition: height 0.3s ease-out;
        }

        .earth-image {
            position: absolute;
            inset: 0;
            background: url('https://upload.wikimedia.org/wikipedia/commons/9/97/The_earth_at_night.jpg') center/cover;
            opacity: 0;
            transition: opacity 0.3s;
            mask-image: radial-gradient(circle, black, transparent);
        }

        .progress-section {
            margin: 16px 0;
        }

        .progress-bar {
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s;
        }

        .counter {
            font-size: clamp(2.5rem, 10vw, 4rem);
            font-weight: bold;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 16px;
            margin: 16px 0;
            border: 2px solid rgba(255,215,0,0.3);
            text-shadow: 0 0 20px rgba(255,215,0,0.5);
        }

        .name-section {
            margin: 20px 0;
            min-height: 80px;
        }

        .name-input-group {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .name-input {
            padding: 12px 20px;
            border-radius: 30px;
            border: none;
            width: 250px;
            font-size: 1.1em;
            background: rgba(255,255,255,0.95);
        }

        .name-button {
            padding: 12px 30px;
            border-radius: 30px;
            border: none;
            background: #ffd700;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: 0.2s;
        }

        .name-button:hover {
            background: #ffed4a;
            transform: scale(1.05);
        }

        .greeting {
            font-size: 1.4em;
            padding: 12px 24px;
            background: rgba(255,255,255,0.15);
            border-radius: 40px;
            display: inline-block;
            border: 2px solid #ffd700;
        }

        .greeting-name {
            color: #ffd700;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }

        .click-button {
            background: #ffd700;
            color: #333;
            border: none;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            padding: 20px 40px;
            border-radius: 60px;
            cursor: pointer;
            font-weight: bold;
            margin: 16px 0;
            transition: all 0.2s;
            box-shadow: 0 0 30px rgba(255,215,0,0.5);
            width: 100%;
            max-width: 400px;
        }

        .click-button:not(:disabled):hover {
            transform: scale(1.05);
            background: #ffed4a;
            box-shadow: 0 0 50px rgba(255,215,0,0.8);
        }

        .click-button:not(:disabled):active {
            transform: scale(0.95);
        }

        .click-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            border-radius: 16px;
            padding: 12px;
            font-size: 0.9rem;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            margin-top: 4px;
        }

        .top-players {
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 16px;
            margin-top: 20px;
        }

        .top-title {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 16px;
        }

        .top-list {
            list-style: none;
        }

        .top-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            margin: 6px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            transition: 0.2s;
        }

        .top-item.current {
            border: 2px solid #ffd700;
            background: rgba(255,215,0,0.15);
        }

        .top-rank {
            width: 32px;
            height: 32px;
            background: #ffd700;
            color: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .top-rank-1 { background: #FFD700; box-shadow: 0 0 15px #FFD700; }
        .top-rank-2 { background: #C0C0C0; box-shadow: 0 0 15px #C0C0C0; }
        .top-rank-3 { background: #CD7F32; box-shadow: 0 0 15px #CD7F32; }

        .top-name {
            flex: 1;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .top-score {
            font-weight: bold;
            color: #ffd700;
            margin-left: 8px;
        }

        .last-clicker {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 10px;
            margin-top: 16px;
        }

        #lastClickerName {
            color: #ffd700;
            font-weight: bold;
        }

        .cheater-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff4444;
            color: white;
            padding: 16px 24px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(255,0,0,0.5);
            z-index: 1000;
            animation: slideDown 0.3s;
            display: none;
        }

        .god-mode-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255,215,0,0.9);
            color: #333;
            padding: 8px 16px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(255,215,0,0.5);
            z-index: 1000;
            border: 2px solid white;
        }

        .creator-panel-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255,215,0,0.9);
            color: #333;
            padding: 12px 20px;
            border-radius: 40px;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .creator-panel-btn:hover {
            transform: scale(1.05);
            background: #ffd700;
        }

        .creator-panel-btn .notification {
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            margin-left: 8px;
        }

        .creator-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a3a, #2a2a4a);
            border: 3px solid #ffd700;
            border-radius: 30px;
            padding: 30px;
            z-index: 2000;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(255,215,0,0.3);
            display: none;
        }

        .creator-panel.show {
            display: block;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255,215,0,0.3);
            padding-bottom: 15px;
        }

        .panel-header h2 {
            color: #ffd700;
            font-size: 1.8rem;
        }

        .close-panel {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }

        .close-panel:hover {
            background: rgba(255,0,0,0.3);
        }

        .banned-list {
            margin-top: 20px;
        }

        .banned-item {
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid #ff4444;
            transition: 0.2s;
        }

        .banned-item:hover {
            background: rgba(255,255,255,0.15);
            transform: translateX(5px);
        }

        .banned-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .banned-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
        }

        .banned-score {
            background: rgba(255,215,0,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 1.1rem;
        }

        .banned-reason {
            color: #ffaaaa;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .banned-time {
            color: #aaa;
            font-size: 0.8rem;
            margin-bottom: 15px;
        }

        .banned-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            flex: 1;
            min-width: 100px;
        }

        .unban-btn {
            background: #4CAF50;
            color: white;
        }

        .unban-btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .warn-btn {
            background: #ffd700;
            color: #333;
        }

        .warn-btn:hover {
            background: #ffed4a;
            transform: scale(1.05);
        }

        .delete-btn {
            background: #ff4444;
            color: white;
        }

        .delete-btn:hover {
            background: #cc0000;
            transform: scale(1.05);
        }

        .empty-list {
            text-align: center;
            padding: 30px;
            color: #aaa;
            font-size: 1.2rem;
        }

        .panel-stats {
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            text-align: center;
        }

        .stat-item {
            color: #ffd700;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #aaa;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1500;
            display: none;
        }

        .backdrop.show {
            display: block;
        }

        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        .unban-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 16px 24px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(76,175,80,0.5);
            z-index: 1000;
            animation: slideDown 0.3s;
            display: none;
        }
    </style>
</head>
<body>
    <div class="cheater-alert" id="cheaterAlert">üö´ –û–±–Ω–∞—Ä—É–∂–µ–Ω —á–∏—Ç–µ—Ä! –î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</div>
    <div class="unban-message" id="unbanMessage">‚úÖ –í—ã –±—ã–ª–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º!</div>
    
    <div class="creator-panel-btn" id="creatorPanelBtn">
        <span>üëë –ü–∞–Ω–µ–ª—å</span>
        <span class="notification" id="bannedNotification">0</span>
    </div>
    
    <div class="backdrop" id="backdrop"></div>
    
    <div class="creator-panel" id="creatorPanel">
        <div class="panel-header">
            <h2>üëë –ü–∞–Ω–µ–ª—å</h2>
            <button class="close-panel" id="closePanel">√ó</button>
        </div>
        
        <div class="panel-stats">
            <div>
                <div class="stat-label">–í—Å–µ–≥–æ</div>
                <div class="stat-number" id="totalPlayers">0</div>
            </div>
            <div>
                <div class="stat-label">–ó–∞–±–∞–Ω–µ–Ω–æ</div>
                <div class="stat-number" id="totalBanned">0</div>
            </div>
            <div>
                <div class="stat-label">–û–Ω–ª–∞–π–Ω</div>
                <div class="stat-number" id="totalOnline">0</div>
            </div>
        </div>
        
        <div class="banned-list" id="bannedList">
            <div class="empty-list">–ù–µ—Ç –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö</div>
        </div>
    </div>

    <div class="god-mode-badge" id="godModeBadge">üëë –†–µ–∂–∏–º</div>

    <div class="container">
        <h1>üåç –ó–∞—Å–µ–ª–µ–Ω–∏–µ –ó–µ–º–ª–∏</h1>
        <p>–¶–µ–ª—å: 8 –º–ª—Ä–¥ –∫–ª–∏–∫–æ–≤</p>
        
        <div class="earth" id="earth">
            <div class="earth-fill" id="earthFill"></div>
            <div class="earth-image" id="earthImage"></div>
        </div>
        
        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="earth-target">
                <span id="currentPop">0</span> / 8 000 000 000
            </div>
        </div>
        
        <div class="counter" id="counter">0</div>
        
        <div class="name-section">
            <div id="nameInputGroup" class="name-input-group">
                <input type="text" id="username" class="name-input" placeholder="–í–∞—à–µ –∏–º—è" maxlength="20" autocomplete="off">
                <button id="saveNameBtn" class="name-button">–ù–∞—á–∞—Ç—å</button>
            </div>
            <div id="greeting" class="greeting hidden">
                <span>–ò–≥—Ä–æ–∫: <span id="displayName" class="greeting-name"></span></span>
            </div>
        </div>
        
        <button id="clickBtn" class="click-button" disabled>üëÜ –ó–ê–°–ï–õ–ò–¢–¨</button>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div>–û–Ω–ª–∞–π–Ω</div>
                <div class="stat-value" id="onlineCount">0</div>
            </div>
            <div class="stat-card">
                <div>–¢–≤–æ–π –≤–∫–ª–∞–¥</div>
                <div class="stat-value" id="userScore">0</div>
            </div>
            <div class="stat-card">
                <div>–û—Å—Ç–∞–ª–æ—Å—å</div>
                <div class="stat-value" id="remaining">8 –º–ª—Ä–¥</div>
            </div>
        </div>
        
        <div class="top-players">
            <div class="top-title">üèÜ –¢–æ–ø</div>
            <div id="topList" class="top-list">
                <div class="top-item">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
        
        <div class="last-clicker">
            –ü–æ—Å–ª–µ–¥–Ω–∏–π: <span id="lastClickerName">–Ω–∏–∫—Ç–æ</span>
        </div>
    </div>

    <!-- Firebase SDK (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        (function() {
            'use strict';
            
            // ===== –ó–ê–ú–ê–°–ö–ò–†–û–í–ê–ù–ù–´–ï –î–ê–ù–ù–´–ï =====
            const _0x4d5e = {
                api: 'QUl6YVN5QV9nTmtMTXN4VG5lVHd5ZzViRHhLQk45b3NSSVVyUGFF',
                auth: 'dGhlLWNvbG9ueS10YXAuZmlyZWJhc2VhcHAuY29t',
                db: 'aHR0cHM6Ly90aGUtY29sb255LXRhcC1kZWZhdWx0LXJ0ZGIuZmlyZWJhc2Vpby5jb20=',
                project: 'dGhlLWNvbG9ueS10YXA=',
                storage: 'dGhlLWNvbG9ueS10YXAuZmlyZWJhc3VzdG9yYWdlLmFwcA==',
                sender: 'NDMzNDM4NzMzNjE2',
                app: 'MTo0MzM0Mzg3MzM2MTY6d2ViOjc2MDk1YTM2MTYxYjMyNTkwZDQ0ZjU='
            };

            const _decode = (str) => {
                try { return atob(str); } catch { return ''; }
            };

            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
            const C = {
                TARGET: 8000000000,
                STORAGE: { N: 'wc_n', S: 'wc_s', I: 'wc_i', NS: 'wc_ns', CC: 'wc_cc', GM: 'wc_gm' },
                LIMITS: { M1: 20, M2: 300, M3: 1000, INT: 5000, BAN: 3 },
                KEY: 'Lm9rMjAyNQ=='
            };

            // Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            firebase.initializeApp({
                apiKey: _decode(_0x4d5e.api),
                authDomain: _decode(_0x4d5e.auth),
                databaseURL: _decode(_0x4d5e.db),
                projectId: _decode(_0x4d5e.project),
                storageBucket: _decode(_0x4d5e.storage),
                messagingSenderId: _decode(_0x4d5e.sender),
                appId: _decode(_0x4d5e.app)
            });

            const db = firebase.database();
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
            const el = {
                e: document.getElementById('earth'),
                ef: document.getElementById('earthFill'),
                ei: document.getElementById('earthImage'),
                pf: document.getElementById('progressFill'),
                c: document.getElementById('counter'),
                cp: document.getElementById('currentPop'),
                r: document.getElementById('remaining'),
                oc: document.getElementById('onlineCount'),
                us: document.getElementById('userScore'),
                lc: document.getElementById('lastClickerName'),
                tl: document.getElementById('topList'),
                nig: document.getElementById('nameInputGroup'),
                g: document.getElementById('greeting'),
                dn: document.getElementById('displayName'),
                un: document.getElementById('username'),
                snb: document.getElementById('saveNameBtn'),
                cb: document.getElementById('clickBtn'),
                ca: document.getElementById('cheaterAlert'),
                um: document.getElementById('unbanMessage'),
                gmb: document.getElementById('godModeBadge'),
                cpbtn: document.getElementById('creatorPanelBtn'),
                cpanel: document.getElementById('creatorPanel'),
                bd: document.getElementById('backdrop'),
                close: document.getElementById('closePanel'),
                bl: document.getElementById('bannedList'),
                bn: document.getElementById('bannedNotification'),
                tp: document.getElementById('totalPlayers'),
                tb: document.getElementById('totalBanned'),
                to: document.getElementById('totalOnline')
            };

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ
            const s = {
                u: '',
                sc: 0,
                pid: null,
                ns: false,
                or: null,
                pr: null,
                ct: [],
                lsc: 0,
                lch: Date.now(),
                cc: 0,
                b: false,
                gm: false,
                ap: {},
                pl: null
            };

            // –•—Ä–∞–Ω–∏–ª–∏—â–µ
            const stor = {
                g: (k) => { try { return localStorage.getItem(C.STORAGE[k]); } catch { return null; } },
                s: (k, v) => { try { localStorage.setItem(C.STORAGE[k], v); } catch {} },
                r: (k) => { try { localStorage.removeItem(C.STORAGE[k]); } catch {} }
            };

            // ===== UI =====
            function uUI() {
                if (s.b && !s.gm) {
                    el.cb.disabled = true;
                    el.e.style.pointerEvents = 'none';
                } else if (s.ns) {
                    el.cb.disabled = false;
                    el.e.style.pointerEvents = 'auto';
                }
                
                if (s.ns && s.u) {
                    el.nig.classList.add('hidden');
                    el.g.classList.remove('hidden');
                    el.dn.textContent = s.u;
                } else {
                    el.nig.classList.remove('hidden');
                    el.g.classList.add('hidden');
                }

                const p = Math.min((s.sc / C.TARGET) * 100, 100);
                el.ef.style.height = p + '%';
                el.ei.style.opacity = p / 100;
                el.pf.style.width = p + '%';
                
                if (p < 30) el.ef.style.background = 'linear-gradient(180deg, #4CAF50, #2E7D32)';
                else if (p < 70) el.ef.style.background = 'linear-gradient(180deg, #FFC107, #FF8F00)';
                else el.ef.style.background = 'linear-gradient(180deg, #FF5722, #BF360C)';

                el.c.textContent = s.sc.toLocaleString();
                el.cp.textContent = s.sc.toLocaleString();
                el.r.textContent = Math.max(C.TARGET - s.sc, 0).toLocaleString();
                el.us.textContent = (s.pr ? s.sc : 0).toLocaleString();
            }

            // ===== –°–õ–£–®–ê–¢–ï–õ–¨ –°–¢–ê–¢–£–°–ê =====
            function setupListener() {
                if (!s.pid) return;
                if (s.pl) db.ref('players/' + s.pid).off('value', s.pl);
                
                s.pl = db.ref('players/' + s.pid).on('value', (snap) => {
                    const d = snap.val();
                    if (!d) return;
                    
                    const wasB = s.b;
                    const isB = d.b === true;
                    
                    if (wasB !== isB) {
                        s.b = isB;
                        if (!isB && wasB) {
                            el.um.style.display = 'block';
                            setTimeout(() => { el.um.style.display = 'none'; }, 3000);
                            el.cb.disabled = false;
                            el.e.style.pointerEvents = 'auto';
                            el.ca.style.display = 'none';
                            if (d.sc !== undefined) {
                                s.sc = d.sc;
                                stor.s('S', d.sc);
                            }
                        }
                        if (isB && !wasB) {
                            el.cb.disabled = true;
                            el.e.style.pointerEvents = 'none';
                        }
                    }
                    uUI();
                });
            }

            // ===== –ü–ê–ù–ï–õ–¨ =====
            const panel = {
                open() {
                    if (!s.gm) {
                        const secret = prompt('–ö–æ–¥:');
                        if (secret === atob(C.KEY)) {
                            tools.unbanSelf();
                            setTimeout(() => {
                                el.cpanel.classList.add('show');
                                el.bd.classList.add('show');
                                this.update();
                            }, 500);
                        }
                        return;
                    }
                    el.cpanel.classList.add('show');
                    el.bd.classList.add('show');
                    this.update();
                },
                close() {
                    el.cpanel.classList.remove('show');
                    el.bd.classList.remove('show');
                },
                update() {
                    if (!s.gm) return;
                    
                    const banned = Object.entries(s.ap)
                        .filter(([id, d]) => d.b === true)
                        .map(([id, d]) => ({ id, ...d }))
                        .sort((a, b) => (b.cc || 0) - (a.cc || 0));
                    
                    el.tp.textContent = Object.keys(s.ap).length;
                    el.tb.textContent = banned.length;
                    el.bn.textContent = banned.length;
                    
                    if (banned.length === 0) {
                        el.bl.innerHTML = '<div class="empty-list">–ù–µ—Ç</div>';
                        return;
                    }
                    
                    el.bl.innerHTML = banned.map(p => `
                        <div class="banned-item" data-id="${p.id}">
                            <div class="banned-header">
                                <span class="banned-name">${p.n || '–ê–Ω–æ–Ω–∏–º'}</span>
                                <span class="banned-score">${(p.sc || 0).toLocaleString()}</span>
                            </div>
                            <div class="banned-reason">üö´ ${p.br || '–ê–≤—Ç–æ'}</div>
                            <div class="banned-actions">
                                <button class="action-btn unban-btn" onclick="window.unban('${p.id}')">‚úÖ</button>
                                <button class="action-btn delete-btn" onclick="window.del('${p.id}')">üóëÔ∏è</button>
                            </div>
                        </div>
                    `).join('');
                }
            };

            // ===== –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ =====
            window.unban = (id) => {
                if (!s.gm) return;
                db.ref('players/' + id).update({ b: false, br: null, bt: null, cc: 0 })
                    .then(() => panel.update());
            };

            window.del = (id) => {
                if (!s.gm || !confirm('–£–¥–∞–ª–∏—Ç—å?')) return;
                db.ref('players/' + id).remove().then(() => panel.update());
            };

            const tools = {
                unbanSelf() {
                    s.b = false;
                    s.cc = 0;
                    s.gm = true;
                    stor.r('CC');
                    stor.s('GM', 'true');
                    el.cb.disabled = false;
                    el.e.style.pointerEvents = 'auto';
                    el.gmb.style.display = 'block';
                    if (s.pr) s.pr.update({ b: false, cc: 0, gm: true });
                }
            };

            // ===== –ê–ù–¢–ò–ß–ò–¢ =====
            const ac = {
                check() {
                    if (s.gm) return true;
                    if (s.b) return false;
                    
                    const now = Date.now();
                    const sec = s.ct.filter(t => t > now - 1000).length;
                    const min = s.ct.filter(t => t > now - 60000).length;
                    
                    if (sec > C.LIMITS.M1) { this.record('–ß–∞—Å—Ç–æ'); return false; }
                    if (min > C.LIMITS.M2) { this.record('–ú–Ω–æ–≥–æ'); return false; }
                    
                    if (now - s.lch > C.LIMITS.INT) {
                        if (s.sc - s.lsc > C.LIMITS.M3) { this.record('–†–æ—Å—Ç'); return false; }
                        s.lsc = s.sc;
                        s.lch = now;
                    }
                    return true;
                },
                record(r) {
                    if (s.gm) return;
                    s.cc++;
                    stor.s('CC', s.cc);
                    
                    el.ca.style.display = 'block';
                    setTimeout(() => { el.ca.style.display = 'none'; }, 3000);
                    
                    if (s.cc >= C.LIMITS.BAN) {
                        s.b = true;
                        el.cb.disabled = true;
                        el.e.style.pointerEvents = 'none';
                        if (s.pr) s.pr.update({ b: true, cc: s.cc, br: r, bt: Date.now() });
                        if (s.or) s.or.remove();
                    }
                },
                clean() {
                    const now = Date.now();
                    s.ct = s.ct.filter(t => t > now - 120000);
                }
            };

            // ===== FIREBASE –°–õ–£–®–ê–¢–ï–õ–ò =====
            db.ref('globalCounter').on('value', snap => {
                if (!s.b || s.gm) {
                    s.sc = snap.val() || 0;
                    uUI();
                }
            });

            db.ref('lastClick').on('value', snap => {
                if (!s.b || s.gm) {
                    const d = snap.val();
                    el.lc.textContent = d?.n || '–Ω–∏–∫—Ç–æ';
                }
            });

            db.ref('onlineUsers').on('value', snap => {
                if (!s.b || s.gm) {
                    const cnt = snap.val() ? Object.keys(snap.val()).length : 0;
                    el.oc.textContent = cnt;
                    if (s.gm) el.to.textContent = cnt;
                }
            });

            db.ref('players').on('value', snap => {
                const players = snap.val() || {};
                s.ap = players;
                
                if (!s.b || s.gm) {
                    const list = Object.entries(players)
                        .map(([id, d]) => ({ id, ...d }))
                        .filter(p => p.sc > 0 && !p.b)
                        .sort((a, b) => b.sc - a.sc)
                        .slice(0, 10);

                    el.tl.innerHTML = list.length ? list.map((p, i) => {
                        const rc = i === 0 ? 'top-rank-1' : i === 1 ? 'top-rank-2' : i === 2 ? 'top-rank-3' : '';
                        const cur = p.id === s.pid;
                        return `
                            <div class="top-item ${cur ? 'current' : ''}">
                                <div class="top-rank ${rc}">${i + 1}</div>
                                <span class="top-name">${p.n || '–ê–Ω–æ–Ω–∏–º'}</span>
                                <span class="top-score">${p.sc.toLocaleString()}</span>
                            </div>
                        `;
                    }).join('') : '<div class="top-item">–ù–µ—Ç –∫–ª–∏–∫–æ–≤</div>';
                }
                
                if (s.gm) panel.update();
                
                if (s.pid && players[s.pid] && (!s.b || s.gm)) {
                    const fbSc = players[s.pid].sc || 0;
                    if (fbSc !== s.sc) {
                        s.sc = fbSc;
                        stor.s('S', fbSc);
                        uUI();
                    }
                }
            });

            // ===== –ö–õ–ò–ö =====
            async function clickHandler() {
                if (!ac.check()) return;
                
                s.ct.push(Date.now());
                ac.clean();

                try {
                    const r = await db.ref('globalCounter').transaction(v => (v || 0) + 1);
                    if (r.committed) {
                        await db.ref('lastClick').set({ n: s.u, t: Date.now(), pid: s.pid });
                        
                        if (s.pr && (!s.b || s.gm)) {
                            const pr = await s.pr.transaction(p => {
                                if (!p) p = { sc: 0 };
                                p.sc = (p.sc || 0) + 1;
                                p.n = s.u;
                                p.ls = Date.now();
                                p.cc = s.cc;
                                return p;
                            });
                            if (pr.committed) {
                                s.sc = pr.snapshot.val().sc;
                                stor.s('S', s.sc);
                            }
                        }

                        if (r.snapshot.val() >= C.TARGET) alert('üéâ –ü–û–ë–ï–î–ê! üéâ');
                    }
                } catch (e) {}
            }

            // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
            function init() {
                s.gm = stor.g('GM') === 'true';
                if (s.gm) el.gmb.style.display = 'block';
                
                s.ns = stor.g('NS') === 'true';
                s.u = stor.g('N') || '';
                s.pid = stor.g('I') || null;
                s.sc = parseInt(stor.g('S') || '0');
                s.cc = parseInt(stor.g('CC') || '0');
                
                if (s.cc >= C.LIMITS.BAN && s.gm) {
                    s.b = false;
                    s.cc = 0;
                }

                if (s.u) el.un.value = s.u;

                if (s.ns && s.pid) {
                    db.ref('players/' + s.pid).once('value').then(snap => {
                        if (snap.exists()) {
                            const d = snap.val();
                            s.pr = db.ref('players/' + s.pid);
                            s.b = d.b === true;
                            
                            if (d.sc < s.sc) s.pr.update({ sc: s.sc, n: s.u, ls: Date.now() });
                            else {
                                s.sc = d.sc;
                                stor.s('S', d.sc);
                            }
                            setupListener();
                        } else if (!s.b || s.gm) createPlayer();
                        uUI();
                    });
                } else if (s.ns && (!s.b || s.gm)) createPlayer();

                uUI();
                
                // –û–Ω–ª–∞–π–Ω
                if (!s.b || s.gm) {
                    s.or = db.ref('onlineUsers').push();
                    s.or.set({ n: s.u || '–ê–Ω–æ–Ω–∏–º', on: true, ls: Date.now(), pid: s.pid });
                    
                    window.addEventListener('beforeunload', () => {
                        if (s.or) s.or.remove();
                        if (s.pr && (!s.b || s.gm)) {
                            s.pr.update({ ls: Date.now(), on: false, cc: s.cc });
                            stor.s('S', s.sc);
                        }
                    });
                }

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                el.snb.addEventListener('click', () => {
                    const name = el.un.value.trim();
                    if (!name) return;
                    s.u = name;
                    s.ns = true;
                    stor.s('N', name);
                    stor.s('NS', 'true');
                    createPlayer();
                    uUI();
                });

                el.un.addEventListener('keypress', e => e.key === 'Enter' && el.snb.click());
                el.cb.addEventListener('click', clickHandler);
                el.e.addEventListener('click', clickHandler);
                
                el.cpbtn.addEventListener('click', () => panel.open());
                el.close.addEventListener('click', () => panel.close());
                el.bd.addEventListener('click', () => panel.close());

                setInterval(() => {
                    if (s.b && !s.gm) return;
                    ac.check();
                    ac.clean();
                    if (s.or) s.or.update({ ls: Date.now(), n: s.u || '–ê–Ω–æ–Ω–∏–º', cc: s.cc });
                    if (s.pr && s.ns && (!s.b || s.gm)) {
                        s.pr.update({ ls: Date.now(), n: s.u, cc: s.cc });
                        stor.s('S', s.sc);
                    }
                }, 15000);

                // –û—Ç–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Å–æ–ª—å
                console.clear();
                console.log = function(){};
                console.warn = function(){};
                console.error = function(){};
                console.info = function(){};
                console.debug = function(){};
            }

            function createPlayer() {
                if (s.b && !s.gm) return;
                
                const nr = db.ref('players').push();
                nr.set({
                    n: s.u,
                    sc: s.sc,
                    j: Date.now(),
                    ls: Date.now(),
                    cc: s.cc,
                    b: false
                }).then(() => {
                    s.pr = nr;
                    s.pid = nr.key;
                    stor.s('I', s.pid);
                    s.b = false;
                    setupListener();
                });
            }

            init();

            // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (—Å–∫—Ä—ã—Ç—ã–µ)
            window.t = tools;
        })();
    </script>
</body>
</html>