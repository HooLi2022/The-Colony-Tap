<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç –ó–∞—Å–µ–ª–µ–Ω–∏–µ –ó–µ–º–ª–∏</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0B0B2B, #1B1B4B);
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            padding: 16px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            text-align: center;
        }

        .earth {
            position: relative;
            width: min(280px, 60vw);
            height: min(280px, 60vw);
            margin: 16px auto;
            border-radius: 50%;
            background: #2B3B4B;
            box-shadow: 0 0 40px rgba(100,150,255,0.3);
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .earth:active {
            transform: scale(0.98);
        }

        .earth-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(180deg, #4CAF50, #2E7D32);
            transition: height 0.3s ease-out;
            border-radius: 0 0 50% 50%;
        }

        .earth-image {
            position: absolute;
            inset: 0;
            background: url('https://upload.wikimedia.org/wikipedia/commons/9/97/The_earth_at_night.jpg') center/cover;
            opacity: 0;
            transition: opacity 0.3s;
            mask-image: radial-gradient(circle, black, transparent);
        }

        .progress-section {
            margin: 16px 0;
        }

        .progress-bar {
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s;
        }

        .counter {
            font-size: clamp(2.5rem, 10vw, 4rem);
            font-weight: bold;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 16px;
            margin: 16px 0;
            border: 2px solid rgba(255,215,0,0.3);
            text-shadow: 0 0 20px rgba(255,215,0,0.5);
        }

        .name-section {
            margin: 20px 0;
            min-height: 80px;
        }

        .name-input-group {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .name-input {
            padding: 12px 20px;
            border-radius: 30px;
            border: none;
            width: 250px;
            font-size: 1.1em;
            background: rgba(255,255,255,0.95);
        }

        .name-button {
            padding: 12px 30px;
            border-radius: 30px;
            border: none;
            background: #ffd700;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: 0.2s;
        }

        .name-button:hover {
            background: #ffed4a;
            transform: scale(1.05);
        }

        .greeting {
            font-size: 1.4em;
            padding: 12px 24px;
            background: rgba(255,255,255,0.15);
            border-radius: 40px;
            display: inline-block;
            border: 2px solid #ffd700;
        }

        .greeting-name {
            color: #ffd700;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }

        .click-button {
            background: #ffd700;
            color: #333;
            border: none;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            padding: 20px 40px;
            border-radius: 60px;
            cursor: pointer;
            font-weight: bold;
            margin: 16px 0;
            transition: all 0.2s;
            box-shadow: 0 0 30px rgba(255,215,0,0.5);
            width: 100%;
            max-width: 400px;
        }

        .click-button:not(:disabled):hover {
            transform: scale(1.05);
            background: #ffed4a;
            box-shadow: 0 0 50px rgba(255,215,0,0.8);
        }

        .click-button:not(:disabled):active {
            transform: scale(0.95);
        }

        .click-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            border-radius: 16px;
            padding: 12px;
            font-size: 0.9rem;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            margin-top: 4px;
        }

        .top-players {
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 16px;
            margin-top: 20px;
        }

        .top-title {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 16px;
        }

        .top-list {
            list-style: none;
        }

        .top-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            margin: 6px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            transition: 0.2s;
        }

        .top-item.current {
            border: 2px solid #ffd700;
            background: rgba(255,215,0,0.15);
        }

        .top-rank {
            width: 32px;
            height: 32px;
            background: #ffd700;
            color: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .top-rank-1 { background: #FFD700; box-shadow: 0 0 15px #FFD700; }
        .top-rank-2 { background: #C0C0C0; box-shadow: 0 0 15px #C0C0C0; }
        .top-rank-3 { background: #CD7F32; box-shadow: 0 0 15px #CD7F32; }

        .top-name {
            flex: 1;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .top-score {
            font-weight: bold;
            color: #ffd700;
            margin-left: 8px;
        }

        .last-clicker {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 10px;
            margin-top: 16px;
        }

        #lastClickerName {
            color: #ffd700;
            font-weight: bold;
        }

        .cheater-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff4444;
            color: white;
            padding: 16px 24px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(255,0,0,0.5);
            z-index: 1000;
            animation: slideDown 0.3s;
            display: none;
        }

        .god-mode-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255,215,0,0.9);
            color: #333;
            padding: 8px 16px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(255,215,0,0.5);
            z-index: 1000;
            display: none;
            border: 2px solid white;
        }

        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="cheater-alert" id="cheaterAlert">üö´ –û–±–Ω–∞—Ä—É–∂–µ–Ω —á–∏—Ç–µ—Ä! –î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</div>
    <div class="god-mode-badge" id="godModeBadge">üëë –†–µ–∂–∏–º —Å–æ–∑–¥–∞—Ç–µ–ª—è</div>

    <div class="container">
        <h1>üåç –ó–∞—Å–µ–ª–µ–Ω–∏–µ –ó–µ–º–ª–∏</h1>
        <p>–¶–µ–ª—å: 8 –º–ª—Ä–¥ –∫–ª–∏–∫–æ–≤</p>
        
        <div class="earth" id="earth">
            <div class="earth-fill" id="earthFill"></div>
            <div class="earth-image" id="earthImage"></div>
        </div>
        
        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="earth-target">
                <span id="currentPop">0</span> / 8 000 000 000
            </div>
        </div>
        
        <div class="counter" id="counter">0</div>
        
        <div class="name-section">
            <div id="nameInputGroup" class="name-input-group">
                <input type="text" id="username" class="name-input" placeholder="–í–∞—à–µ –∏–º—è" maxlength="20" autocomplete="off">
                <button id="saveNameBtn" class="name-button">–ù–∞—á–∞—Ç—å</button>
            </div>
            <div id="greeting" class="greeting hidden">
                <span>–ò–≥—Ä–æ–∫: <span id="displayName" class="greeting-name"></span></span>
            </div>
        </div>
        
        <button id="clickBtn" class="click-button" disabled>üëÜ –ó–ê–°–ï–õ–ò–¢–¨</button>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div>–û–Ω–ª–∞–π–Ω</div>
                <div class="stat-value" id="onlineCount">0</div>
            </div>
            <div class="stat-card">
                <div>–¢–≤–æ–π –≤–∫–ª–∞–¥</div>
                <div class="stat-value" id="userScore">0</div>
            </div>
            <div class="stat-card">
                <div>–û—Å—Ç–∞–ª–æ—Å—å</div>
                <div class="stat-value" id="remaining">8 –º–ª—Ä–¥</div>
            </div>
        </div>
        
        <div class="top-players">
            <div class="top-title">üèÜ –¢–æ–ø –∑–∞—Å–µ–ª—å–Ω–∏–∫–æ–≤</div>
            <div id="topList" class="top-list">
                <div class="top-item" style="justify-content: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
        
        <div class="last-clicker">
            –ü–æ—Å–ª–µ–¥–Ω–∏–π: <span id="lastClickerName">–Ω–∏–∫—Ç–æ</span>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        (function() {
            'use strict';
            
            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
            const CONFIG = {
                TARGET: 8000000000,
                DB_URL: 'https://the-colony-tap-default-rtdb.firebaseio.com',
                STORAGE: {
                    NAME: 'wc_name',
                    SCORE: 'wc_score',
                    ID: 'wc_id',
                    NAME_SET: 'wc_set',
                    CHEAT_COUNT: 'wc_cheat',
                    GOD_MODE: 'wc_god' // –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è
                },
                LIMITS: {
                    MAX_CLICKS_PER_SECOND: 20,
                    MAX_CLICKS_PER_MINUTE: 300,
                    MAX_SCORE_GROWTH: 1000,
                    CHECK_INTERVAL: 5000,
                    BAN_THRESHOLD: 3
                },
                // –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ —Å–æ–∑–¥–∞—Ç–µ–ª—è (–∏–∑–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π!)
                CREATOR_SECRET: 'ILoveMyGame' // –ú–æ–∂–µ—à—å –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ –ª—é–±–æ–µ —Å–ª–æ–≤–æ
            };

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
            firebase.initializeApp({
                apiKey: "AIzaSyA_gNkLMsTxneTwyg5bDxKBN9osRIUrPaE",
                authDomain: "the-colony-tap.firebaseapp.com",
                databaseURL: CONFIG.DB_URL,
                projectId: "the-colony-tap",
                storageBucket: "the-colony-tap.firebasestorage.app",
                messagingSenderId: "433438733616",
                appId: "1:433438733616:web:76095a36161b32590d44f5"
            });

            const db = firebase.database();
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
            const el = {
                earth: document.getElementById('earth'),
                earthFill: document.getElementById('earthFill'),
                earthImage: document.getElementById('earthImage'),
                progressFill: document.getElementById('progressFill'),
                counter: document.getElementById('counter'),
                currentPop: document.getElementById('currentPop'),
                remaining: document.getElementById('remaining'),
                onlineCount: document.getElementById('onlineCount'),
                userScore: document.getElementById('userScore'),
                lastClickerName: document.getElementById('lastClickerName'),
                topList: document.getElementById('topList'),
                nameInputGroup: document.getElementById('nameInputGroup'),
                greeting: document.getElementById('greeting'),
                displayName: document.getElementById('displayName'),
                username: document.getElementById('username'),
                saveNameBtn: document.getElementById('saveNameBtn'),
                clickBtn: document.getElementById('clickBtn'),
                cheaterAlert: document.getElementById('cheaterAlert'),
                godModeBadge: document.getElementById('godModeBadge')
            };

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ
            const state = {
                username: '',
                score: 0,
                playerId: null,
                nameSet: false,
                onlineRef: null,
                playerRef: null,
                loading: true,
                
                // –ó–∞—â–∏—Ç–∞ –æ—Ç —á–∏—Ç–µ—Ä–æ–≤
                clickTimes: [],
                lastScore: 0,
                lastCheck: Date.now(),
                cheatCount: 0,
                banned: false,
                
                // –†–µ–∂–∏–º —Å–æ–∑–¥–∞—Ç–µ–ª—è
                godMode: false,
                
                initComplete: false,
                securityLevel: 'high'
            };

            // ===== –•—Ä–∞–Ω–∏–ª–∏—â–µ =====
            const storage = {
                get: key => {
                    try { return localStorage.getItem(CONFIG.STORAGE[key]); } 
                    catch { return null; }
                },
                set: (key, value) => {
                    try { localStorage.setItem(CONFIG.STORAGE[key], value); } 
                    catch (e) { console.warn('Storage error:', e); }
                },
                remove: key => {
                    try { localStorage.removeItem(CONFIG.STORAGE[key]); } 
                    catch (e) { console.warn('Storage error:', e); }
                }
            };

            // ===== –°–ï–ö–†–ï–¢–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–û–ó–î–ê–¢–ï–õ–Ø =====
            const creatorTools = {
                // –†–∞–∑–±–∞–Ω —Å–∞–º–æ–≥–æ —Å–µ–±—è
                unbanMyself() {
                    state.banned = false;
                    state.cheatCount = 0;
                    state.godMode = true;
                    
                    // –û—á–∏—â–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏ —á–∏—Ç–µ—Ä—Å—Ç–≤–∞
                    storage.remove('CHEAT_COUNT');
                    storage.set('GOD_MODE', 'true');
                    
                    // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    el.clickBtn.disabled = false;
                    el.earth.style.pointerEvents = 'auto';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–µ–π–¥–∂ —Å–æ–∑–¥–∞—Ç–µ–ª—è
                    el.godModeBadge.style.display = 'block';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤ Firebase
                    if (state.playerRef) {
                        state.playerRef.update({
                            banned: false,
                            cheatCount: 0,
                            godMode: true
                        });
                    }
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                    el.cheaterAlert.style.display = 'none';
                    
                    console.log('%cüëë –†–ï–ñ–ò–ú –°–û–ó–î–ê–¢–ï–õ–Ø –ê–ö–¢–ò–í–ò–†–û–í–ê–ù', 'color: gold; font-size: 16px; font-weight: bold');
                    console.log('‚úÖ –¢—ã —Ä–∞–∑–±–∞–Ω–µ–Ω! –ú–æ–∂–µ—à—å –∫–ª–∏–∫–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —Ö–æ—á–µ—à—å!');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    alert('üëë –†–µ–∂–∏–º —Å–æ–∑–¥–∞—Ç–µ–ª—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –∫–ª–∏–∫–∞—Ç—å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π!');
                },
                
                // –î–æ–±–∞–≤–∏—Ç—å —Å–µ–±–µ –∫–ª–∏–∫–∏ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
                addClicks(amount) {
                    if (!state.godMode) {
                        console.warn('‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è!');
                        return;
                    }
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∞—á–∫—É –∫–ª–∏–∫–æ–≤
                    for (let i = 0; i < amount; i++) {
                        setTimeout(() => {
                            simulateClick();
                        }, i * 10);
                    }
                    
                    console.log(`‚ú® –î–æ–±–∞–≤–ª–µ–Ω–æ ${amount} –∫–ª–∏–∫–æ–≤`);
                },
                
                // –°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
                resetGame() {
                    if (!state.godMode) return;
                    
                    if (confirm('‚ö†Ô∏è –¢–æ—á–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å?')) {
                        // –û—á–∏—â–∞–µ–º localStorage
                        localStorage.clear();
                        
                        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º Firebase
                        db.ref('globalCounter').set(0);
                        db.ref('players').remove();
                        db.ref('onlineUsers').remove();
                        
                        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                        location.reload();
                    }
                },
                
                // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                showStats() {
                    if (!state.godMode) return;
                    
                    console.log('üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–û–ó–î–ê–¢–ï–õ–Ø:');
                    console.log('–ò–≥—Ä–æ–∫:', state.username);
                    console.log('–°—á–µ—Ç:', state.score);
                    console.log('ID:', state.playerId);
                    console.log('–ß–∏—Ç–µ—Ä—Å—Ç–≤–æ:', state.cheatCount);
                    console.log('–ë–∞–Ω:', state.banned);
                }
            };

            // –°–∏–º—É–ª—è—Ü–∏—è –∫–ª–∏–∫–∞ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
            function simulateClick() {
                if (state.godMode) {
                    handleClick();
                }
            }

            // ===== –ê–Ω—Ç–∏-—á–∏—Ç —Å–∏—Å—Ç–µ–º–∞ (—Å —É—á–µ—Ç–æ–º —Å–æ–∑–¥–∞—Ç–µ–ª—è) =====
            const antiCheat = {
                checkAutoClicker() {
                    // –°–æ–∑–¥–∞—Ç–µ–ª—é –º–æ–∂–Ω–æ –≤—Å—ë
                    if (state.godMode) return true;
                    if (state.banned) return false;
                    
                    const now = Date.now();
                    const oneSecondAgo = now - 1000;
                    const oneMinuteAgo = now - 60000;
                    
                    const clicksLastSecond = state.clickTimes.filter(t => t > oneSecondAgo).length;
                    const clicksLastMinute = state.clickTimes.filter(t => t > oneMinuteAgo).length;
                    
                    if (clicksLastSecond > CONFIG.LIMITS.MAX_CLICKS_PER_SECOND) {
                        this.recordCheat('–°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –∫–ª–∏–∫–∏');
                        return false;
                    }
                    
                    if (clicksLastMinute > CONFIG.LIMITS.MAX_CLICKS_PER_MINUTE) {
                        this.recordCheat('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∫–ª–∏–∫–æ–≤ –≤ –º–∏–Ω—É—Ç—É');
                        return false;
                    }
                    
                    return true;
                },
                
                checkScoreHack() {
                    if (state.godMode) return true;
                    if (state.banned) return false;
                    
                    const now = Date.now();
                    const timeDiff = now - state.lastCheck;
                    
                    if (timeDiff > CONFIG.LIMITS.CHECK_INTERVAL) {
                        const scoreDiff = state.score - state.lastScore;
                        
                        if (scoreDiff > CONFIG.LIMITS.MAX_SCORE_GROWTH) {
                            this.recordCheat('–ê–Ω–æ–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç —Å—á–µ—Ç–∞');
                            return false;
                        }
                        
                        state.lastScore = state.score;
                        state.lastCheck = now;
                    }
                    
                    return true;
                },
                
                recordCheat(reason) {
                    // –°–æ–∑–¥–∞—Ç–µ–ª—è –Ω–µ –±–∞–Ω–∏–º
                    if (state.godMode) {
                        console.log('üëë –°–æ–∑–¥–∞—Ç–µ–ª—å —á–∏—Ç–µ—Ä–∏—Ç, –Ω–æ –º—ã –ø—Ä–æ–º–æ–ª—á–∏–º:', reason);
                        return;
                    }
                    
                    console.warn('üö´ –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —á–∏—Ç–µ—Ä—Å—Ç–≤–æ:', reason);
                    
                    state.cheatCount++;
                    storage.set('CHEAT_COUNT', state.cheatCount.toString());
                    
                    el.cheaterAlert.style.display = 'block';
                    setTimeout(() => {
                        el.cheaterAlert.style.display = 'none';
                    }, 3000);
                    
                    if (state.cheatCount >= CONFIG.LIMITS.BAN_THRESHOLD) {
                        this.banPlayer();
                    }
                },
                
                banPlayer() {
                    // –°–æ–∑–¥–∞—Ç–µ–ª—è –Ω–µ –±–∞–Ω–∏–º
                    if (state.godMode) return;
                    
                    state.banned = true;
                    
                    el.clickBtn.disabled = true;
                    el.earth.style.pointerEvents = 'none';
                    
                    el.cheaterAlert.style.display = 'block';
                    el.cheaterAlert.style.background = '#8B0000';
                    el.cheaterAlert.textContent = 'üö´ –í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–∏—Ç–æ–≤';
                    
                    if (state.onlineRef) {
                        state.onlineRef.remove();
                    }
                    
                    if (state.playerRef) {
                        state.playerRef.update({ banned: true, cheatCount: state.cheatCount });
                    }
                    
                    console.error('–ò–≥—Ä–æ–∫ –∑–∞–±–∞–Ω–µ–Ω');
                },
                
                validateClick() {
                    if (state.godMode) return true; // –°–æ–∑–¥–∞—Ç–µ–ª—é –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ
                    if (state.banned) return false;
                    
                    return this.checkAutoClicker() && this.checkScoreHack();
                },
                
                cleanup() {
                    const now = Date.now();
                    state.clickTimes = state.clickTimes.filter(t => t > now - 120000);
                }
            };

            // ===== UI –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ =====
            function updateUI() {
                if (state.banned && !state.godMode) return;
                
                // –ò–º—è
                if (state.nameSet && state.username) {
                    el.nameInputGroup.classList.add('hidden');
                    el.greeting.classList.remove('hidden');
                    el.displayName.textContent = state.username;
                    el.clickBtn.disabled = state.banned && !state.godMode;
                } else {
                    el.nameInputGroup.classList.remove('hidden');
                    el.greeting.classList.add('hidden');
                    el.clickBtn.disabled = true;
                }

                // –ó–µ–º–ª—è
                const percent = Math.min((state.score / CONFIG.TARGET) * 100, 100);
                el.earthFill.style.height = percent + '%';
                el.earthImage.style.opacity = percent / 100;
                el.progressFill.style.width = percent + '%';
                
                // –¶–≤–µ—Ç
                if (percent < 30) {
                    el.earthFill.style.background = 'linear-gradient(180deg, #4CAF50, #2E7D32)';
                } else if (percent < 70) {
                    el.earthFill.style.background = 'linear-gradient(180deg, #FFC107, #FF8F00)';
                } else {
                    el.earthFill.style.background = 'linear-gradient(180deg, #FF5722, #BF360C)';
                }

                // –¢–µ–∫—Å—Ç
                el.counter.textContent = state.score.toLocaleString();
                el.currentPop.textContent = state.score.toLocaleString();
                el.remaining.textContent = Math.max(CONFIG.TARGET - state.score, 0).toLocaleString();
                el.userScore.textContent = (state.playerRef ? state.score : 0).toLocaleString();
            }

            // ===== Firebase =====
            function initFirebase() {
                db.ref('globalCounter').on('value', snap => {
                    if (!state.banned || state.godMode) {
                        state.score = snap.val() || 0;
                        updateUI();
                    }
                });

                db.ref('lastClick').on('value', snap => {
                    if (!state.banned || state.godMode) {
                        const data = snap.val();
                        el.lastClickerName.textContent = data?.name || '–Ω–∏–∫—Ç–æ';
                    }
                });

                db.ref('onlineUsers').on('value', snap => {
                    if (!state.banned || state.godMode) {
                        const count = snap.val() ? Object.keys(snap.val()).length : 0;
                        el.onlineCount.textContent = count;
                    }
                });

                db.ref('players').on('value', snap => {
                    if (state.banned && !state.godMode) return;
                    
                    const players = snap.val();
                    if (!players) {
                        el.topList.innerHTML = '<div class="top-item">–ü–æ–∫–∞ –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤</div>';
                        return;
                    }

                    const list = Object.entries(players)
                        .map(([id, data]) => ({ id, ...data }))
                        .filter(p => p.score > 0 && (!p.banned || state.godMode))
                        .sort((a, b) => b.score - a.score)
                        .slice(0, 10);

                    if (!list.length) {
                        el.topList.innerHTML = '<div class="top-item">–ü–æ–∫–∞ –Ω–µ—Ç –∫–ª–∏–∫–æ–≤</div>';
                        return;
                    }

                    el.topList.innerHTML = list.map((p, i) => {
                        const rankClass = i === 0 ? 'top-rank-1' : i === 1 ? 'top-rank-2' : i === 2 ? 'top-rank-3' : '';
                        const isCurrent = p.id === state.playerId;
                        return `
                            <div class="top-item ${isCurrent ? 'current' : ''}">
                                <div class="top-rank ${rankClass}">${i + 1}</div>
                                <span class="top-name">${p.name || '–ê–Ω–æ–Ω–∏–º'}</span>
                                <span class="top-score">${p.score.toLocaleString()}</span>
                            </div>
                        `;
                    }).join('');

                    if (state.playerId && players[state.playerId] && (!state.banned || state.godMode)) {
                        const fbScore = players[state.playerId].score || 0;
                        if (fbScore !== state.score) {
                            state.score = fbScore;
                            storage.set('SCORE', fbScore);
                            updateUI();
                        }
                    }
                });
            }

            // ===== –ò–≥—Ä–æ–∫ =====
            function initPlayer() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å–æ–∑–¥–∞—Ç–µ–ª—å –ª–∏
                state.godMode = storage.get('GOD_MODE') === 'true';
                if (state.godMode) {
                    el.godModeBadge.style.display = 'block';
                }
                
                state.nameSet = storage.get('NAME_SET') === 'true';
                state.username = storage.get('NAME') || '';
                state.playerId = storage.get('ID') || null;
                state.score = parseInt(storage.get('SCORE') || '0');
                state.cheatCount = parseInt(storage.get('CHEAT_COUNT') || '0');
                
                // –ï—Å–ª–∏ –±—ã–ª –∑–∞–±–∞–Ω–µ–Ω, –Ω–æ —ç—Ç–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å - —Ä–∞–∑–±–∞–Ω–∏–≤–∞–µ–º
                if (state.cheatCount >= CONFIG.LIMITS.BAN_THRESHOLD && state.godMode) {
                    state.banned = false;
                    state.cheatCount = 0;
                } else if (state.cheatCount >= CONFIG.LIMITS.BAN_THRESHOLD) {
                    antiCheat.banPlayer();
                    return;
                }

                if (state.username) el.username.value = state.username;

                if (state.nameSet && state.playerId) {
                    db.ref('players/' + state.playerId).once('value').then(snap => {
                        if (snap.exists() && (!state.banned || state.godMode)) {
                            const data = snap.val();
                            state.playerRef = db.ref('players/' + state.playerId);
                            
                            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–∞–Ω (—Å —É—á–µ—Ç–æ–º —Å–æ–∑–¥–∞—Ç–µ–ª—è)
                            if (data.banned && !state.godMode) {
                                antiCheat.banPlayer();
                                return;
                            }
                            
                            if (data.score < state.score) {
                                state.playerRef.update({ 
                                    score: state.score, 
                                    name: state.username,
                                    lastSeen: Date.now()
                                });
                            } else {
                                state.score = data.score;
                                storage.set('SCORE', data.score);
                            }
                        } else if (!state.banned || state.godMode) {
                            createNewPlayer();
                        }
                        updateUI();
                    });
                } else if (state.nameSet && (!state.banned || state.godMode)) {
                    createNewPlayer();
                }

                updateUI();
            }

            function createNewPlayer() {
                if (state.banned && !state.godMode) return;
                
                const newRef = db.ref('players').push();
                newRef.set({
                    name: state.username,
                    score: state.score,
                    joined: Date.now(),
                    lastSeen: Date.now(),
                    cheatCount: state.cheatCount,
                    banned: state.banned || false,
                    godMode: state.godMode || false
                });
                state.playerRef = newRef;
                state.playerId = newRef.key;
                storage.set('ID', state.playerId);
            }

            // ===== –û–Ω–ª–∞–π–Ω =====
            function initOnline() {
                if (state.banned && !state.godMode) return;
                
                state.onlineRef = db.ref('onlineUsers').push();
                state.onlineRef.set({
                    name: state.username || '–ê–Ω–æ–Ω–∏–º',
                    online: true,
                    lastSeen: Date.now(),
                    playerId: state.playerId,
                    godMode: state.godMode || false
                });

                window.addEventListener('beforeunload', () => {
                    if (state.onlineRef) state.onlineRef.remove();
                    if (state.playerRef && (!state.banned || state.godMode)) {
                        state.playerRef.update({ 
                            lastSeen: Date.now(), 
                            online: false,
                            cheatCount: state.cheatCount
                        });
                        storage.set('SCORE', state.score);
                    }
                });
            }

            // ===== –ö–ª–∏–∫ =====
            async function handleClick() {
                // –ó–∞—â–∏—Ç–∞ –æ—Ç —á–∏—Ç–µ—Ä–æ–≤ (—Å–æ–∑–¥–∞—Ç–µ–ª—é –º–æ–∂–Ω–æ)
                if (!antiCheat.validateClick()) return;
                
                state.clickTimes.push(Date.now());
                antiCheat.cleanup();

                try {
                    const result = await db.ref('globalCounter').transaction(v => (v || 0) + 1);
                    if (result.committed) {
                        await db.ref('lastClick').set({ 
                            name: state.username, 
                            timestamp: Date.now(),
                            playerId: state.playerId,
                            godMode: state.godMode || false
                        });
                        
                        if (state.playerRef && (!state.banned || state.godMode)) {
                            const playerResult = await state.playerRef.transaction(p => {
                                if (!p) p = { score: 0 };
                                p.score = (p.score || 0) + 1;
                                p.name = state.username;
                                p.lastSeen = Date.now();
                                p.cheatCount = state.cheatCount;
                                p.godMode = state.godMode || false;
                                return p;
                            });
                            
                            if (playerResult.committed) {
                                state.score = playerResult.snapshot.val().score;
                                storage.set('SCORE', state.score);
                            }
                        }

                        if (result.snapshot.val() >= CONFIG.TARGET) {
                            alert('üéâ –ú–´ –ó–ê–°–ï–õ–ò–õ–ò –ó–ï–ú–õ–Æ! üéâ');
                        }
                    }
                } catch (e) {
                    console.error('Click error:', e);
                }
            }

            // ===== –ò–º—è =====
            function setName() {
                const name = el.username.value.trim();
                if (!name) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');

                state.username = name;
                state.nameSet = true;
                
                storage.set('NAME', name);
                storage.set('NAME_SET', 'true');

                createNewPlayer();
                updateUI();
            }

            // ===== –°–ï–ö–†–ï–¢–ù–ê–Ø –ö–û–ù–°–û–õ–¨–ù–ê–Ø –ö–û–ú–ê–ù–î–ê =====
            window.unbanMe = function(secret) {
                if (secret === CONFIG.CREATOR_SECRET) {
                    creatorTools.unbanMyself();
                } else {
                    console.warn('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥!');
                }
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–æ–∑–¥–∞—Ç–µ–ª—è –≤ –∫–æ–Ω—Å–æ–ª—å (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
            window.creator = {
                unban: () => creatorTools.unbanMyself(),
                addClicks: (amount) => creatorTools.addClicks(amount),
                reset: () => creatorTools.resetGame(),
                stats: () => creatorTools.showStats(),
                secret: CONFIG.CREATOR_SECRET
            };

            console.log(
                '%cüëë –°–ï–ö–†–ï–¢–ù–ê–Ø –ö–û–ú–ê–ù–î–ê –î–õ–Ø –°–û–ó–î–ê–¢–ï–õ–Ø:\n%cunbanMe("' + CONFIG.CREATOR_SECRET + '")\n\n–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –æ–±—ä–µ–∫—Ç creator:\ncreator.unban() - —Ä–∞–∑–±–∞–Ω\ncreator.addClicks(100) - –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–∫–∏\ncreator.stats() - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\ncreator.reset() - —Å–±—Ä–æ—Å –∏–≥—Ä—ã', 
                'color: gold; font-size: 14px; font-weight: bold',
                'color: #4CAF50; font-size: 12px;'
            );

            // ===== –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ =====
            setInterval(() => {
                if (state.banned && !state.godMode) return;
                
                antiCheat.checkScoreHack();
                antiCheat.cleanup();
                
                if (state.onlineRef) {
                    state.onlineRef.update({ 
                        lastSeen: Date.now(), 
                        name: state.username || '–ê–Ω–æ–Ω–∏–º',
                        cheatCount: state.cheatCount,
                        godMode: state.godMode || false
                    });
                }
                
                if (state.playerRef && state.nameSet && (!state.banned || state.godMode)) {
                    state.playerRef.update({ 
                        lastSeen: Date.now(), 
                        name: state.username,
                        cheatCount: state.cheatCount,
                        godMode: state.godMode || false
                    });
                    storage.set('SCORE', state.score);
                }
            }, 15000);

            // ===== –ó–∞–ø—É—Å–∫ =====
            function init() {
                state.cheatCount = parseInt(storage.get('CHEAT_COUNT') || '0');
                
                initFirebase();
                initPlayer();
                initOnline();
                
                el.saveNameBtn.addEventListener('click', setName);
                el.username.addEventListener('keypress', e => e.key === 'Enter' && setName());
                el.clickBtn.addEventListener('click', handleClick);
                el.earth.addEventListener('click', handleClick);

                // –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö —Ö–∞–∫–æ–≤ (–Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º –ª–∞–∑–µ–π–∫—É –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è)
                if (!state.godMode) {
                    // –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞
                }
                
                console.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>
</html>